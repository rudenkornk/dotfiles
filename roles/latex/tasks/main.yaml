- name: Install TeX Live
  become: true
  ansible.builtin.apt:
    name: texlive-full
  retries: 3
  register: latex_installed
  until: latex_installed is not failed

- name: Install support packages
  become: true
  ansible.builtin.apt:
    name:
      - bibclean
      - msttcorefonts
      - poppler-utils
      - python3-pygments
      - ttf-mscorefonts-installer
      - xvfb

- name: Install libasound2 (for Ubuntu < 24.04)
  become: true
  ansible.builtin.apt:
    name:
      - libasound2
  when: ansible_distribution_version is version('24.04', '<')

# Weirdly, liboss4-salsa-asound2 alternative is automatically uninstall by
# java openjdk-21-jdk package, thus choosing libasound2t64 instead
- name: Install libasound2t64 (for Ubuntu >= 24.04)
  become: true
  ansible.builtin.apt:
    name:
      - libasound2t64
  when: ansible_distribution_version is version('24.04', '>=')

- name: Install draw.io
  become: true
  ansible.builtin.apt:
    deb: "{{ manifest.drawio.url }}"
  retries: "{{ web_retries }}"
  delay: "{{ web_delay }}"
  register: latex_installed
  until: latex_installed is not failed

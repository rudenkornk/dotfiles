- name: Bootstrap hosts
  hosts: "{{ hosts_var }}"
  vars:
    ansible_user: root
  gather_facts: false
  tasks:
    - name: Install python
      become: true
      ansible.builtin.raw: |
        if ! command -v python3 &> /dev/null; then \
          if command -v apt-get &> /dev/null; then \
            apt-get update && \
            DEBIAN_FRONTEND=noninteractive \
            apt-get install -y python3; \
          elif command -v dnf &> /dev/null; then \
            dnf install -y python3; \
          else \
            exit 1; \
          fi && \
          echo "bootstrapped";
        fi
      args:
        executable: bash
      register: bootstrap
      changed_when: ("bootstrapped" in bootstrap.stdout)

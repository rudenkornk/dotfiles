- name: Configure terminals
  when: not in_wsl
  block:
    - name: Install WezTerm
      # Actually is laggy on my machine
      become: true
      ansible.builtin.apt:
        deb: "{{ manifest.wezterm.url }}"
      retries: "{{ web_retries }}"
      delay: "{{ web_delay }}"
      register: installed
      until: installed is not failed

    - name: Create symlink to wezterm config
      ansible.builtin.file:
        src: "{{ remote_role_path }}/files/wezterm.lua"
        dest: "{{ home }}/.wezterm.lua"
        state: link
        force: true

    - name: Create ~/.config/tilda/ directory
      ansible.builtin.file:
        dest: "{{ home }}/.config/tilda"
        state: directory
        mode: 0755

    - name: Create symlink to tilda config
      ansible.builtin.file:
        src: "{{ remote_role_path }}/files/tilda.conf"
        dest: "{{ home }}/.config/tilda/config_0"
        state: link
        force: true

    - name: Create ~/.local/share/konsole/ directory
      ansible.builtin.file:
        dest: "{{ home }}/.local/share/konsole"
        state: directory
        mode: 0755

    - name: Create symlink to konsole profile
      ansible.builtin.file:
        src: "{{ remote_role_path }}/files/konsole.profile"
        dest: "{{ home }}/.local/share/konsole/Main.profile"
        state: link
        force: true

    - name: Init ~/.config.konsolerc
      ansible.builtin.lineinfile:
        create: true
        path: "{{ home }}/.config/konsolerc"
        regexp: '\[Desktop Entry\]'
        line: "[Desktop Entry]"
        insertbefore: BOF
        mode: 0644

    - name: Set konsole default profile
      ansible.builtin.lineinfile:
        path: "{{ home }}/.config/konsolerc"
        regexp: 'DefaultProfile='
        line: DefaultProfile=Main.profile
        insertafter: '\[Desktop Entry\]'
